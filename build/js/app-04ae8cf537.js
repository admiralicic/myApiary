!function(){"use strict";angular.module("apiaryApp",["ngComponentRouter","ngAnimate","ui.bootstrap","app.core"]).value("$routerRootComponent","apiaryRoot").config(["$httpProvider",function(e){e.interceptors.push("authInterceptor")}])}(),function(){"use strict";function e(e,t,o){function n(e){var t=o.getToken();return t&&(e.headers.Authorization="Bearer "+t),e}function a(o){return 401===o.status&&t.path("/login"),e.reject(o)}var i={request:n,responseError:a};return i}angular.module("apiaryApp").factory("authInterceptor",e),e.$inject=["$q","$location","tokenService"]}(),function(){"use strict";function e(e,t,o,n){function a(){n.clearToken(),o.path("/home")}function i(t){return e.post("/api/register",t).then(function(e){n.saveToken(e.data.token)})}function r(t){return e.post("/api/login",t).then(function(e){n.saveToken(e.data.token)})}function l(){var e=n.getToken();if(e){var o=JSON.parse(t.atob(e.split(".")[1]));return o.exp>Date.now()/1e3}return!1}function s(){if(l){var e=n.getToken(),o=JSON.parse(t.atob(e.split(".")[1]));return{email:o.email,firstName:o.firstName,lastName:o.lastName}}}var c={register:i,login:r,logout:a,isLoggedIn:l,currentUser:s};return c}angular.module("apiaryApp").factory("authentication",e),e.$inject=["$http","$window","$location","tokenService"]}(),function(){"use strict";function e(e,t){function o(){return e.get("/api/hives")}function n(t){return e.get("/api/hives/"+t)}function a(t){return e.post("/api/hives",t)}function i(t){return e.put("/api/hives/"+t.id,t)}var r={list:o,detail:n,create:a,update:i};return r}angular.module("apiaryApp").factory("hiveService",e),e.$inject=["$http","authentication"]}(),function(){"use strict";function e(e){function t(t){return e.get("/api/hives/"+t+"/inspections")}var o={list:t};return o}angular.module("apiaryApp").factory("inspectionService",e),e.$inject=["$http"]}(),function(){"use strict";function e(e){function t(t){e.localStorage["apiary-token"]=t}function o(){return e.localStorage["apiary-token"]}function n(){e.localStorage.removeItem("apiary-token")}var a={saveToken:t,getToken:o,clearToken:n};return a}angular.module("apiaryApp").factory("tokenService",e),e.$inject=["$window"]}(),function(){"use strict";angular.module("apiaryApp").component("apiaryHome",{templateUrl:"components/home/apiary-home.component.html"})}(),function(){"use strict";function e(e,t){var o=this;o.currentUser={email:"",name:"",password:""},o.$onInit=function(){if(o.isLoggedIn=e.isLoggedIn(),o.isLoggedIn){var t=e.currentUser();o.currentUser.email=t.email,o.currentUser.name=t.firstName+" "+t.lastName}},o.login=function(){o.isLoggedIn=!0,e.login(o.currentUser).then(function(){o.isLoggedIn=e.isLoggedIn()})},o.logout=function(){e.logout(),o.isLoggedIn=e.isLoggedIn()}}angular.module("apiaryApp").component("navigation",{templateUrl:"components/navigation/navigation.component.html",controllerAs:"vm",controller:e}),e.$inject=["authentication","$location"]}(),function(){"use strict";angular.module("apiaryApp").component("apiaryRoot",{templateUrl:"components/root/apiary-root.component.html",$routeConfig:[{path:"/home",component:"apiaryHome",name:"Home",useAsDefault:!0},{path:"/hives",component:"apiaryHives",name:"Hives"},{path:"/hives/:hiveId/...",component:"hiveDetail",name:"HiveDetail"},{path:"/register",component:"registration",name:"Register"},{path:"/login",component:"login",name:"Login"}]})}(),function(){"use strict";function e(){}angular.module("apiaryApp").component("extractionList",{templateUrl:"components/extraction/list/extraction-list.component.html",controller:e,controllerAs:"vm"})}(),function(){"use strict";function e(e,t){var o=this;o.hive={},o.$routerOnActivate=function(e){o.hiveId=e.params.hiveId,t.detail(o.hiveId).then(function(e){o.hive=e.data})["catch"](function(e){console.log(e)})},o.$onInit=function(){},o.popupEditHive=function(){var t=e.open({templateUrl:"components/hives/modal/edit-hive.modal.html",controller:"editHiveController",controllerAs:"vm",windowClass:"center-modal",resolve:{hiveData:function(){var e={_id:o.hive._id,regNo:o.hive.regNo,queenYear:o.hive.queenYear,location:o.hive.location,note:o.hive.note};return e}}});t.result.then(function(e){o.hive=e})}}angular.module("apiaryApp").component("hiveDetail",{templateUrl:"components/hives/detail/hive-detail.component.html",controllerAs:"vm",controller:e,$routeConfig:[{path:"/inspections",component:"inspectionList",name:"Inspections"},{path:"/extractions",component:"extractionList",name:"Extractions"}]}),e.$inject=["$uibModal","hiveService"]}(),function(){"use strict";function e(e,t,o){var n=this;n.hives=[],n.formError="",n.$routerOnActivate=function(e,t){o.list().then(function(e){n.hives=e.data},function(e){console.log(e)})},n.$onChanges=function(){},n.showDetail=function(e){n.$router.navigate(["HiveDetail",{hiveId:e._id},"Inspections"])},n.popupNewHive=function(){var e=t.open({templateUrl:"components/hives/modal/new-hive.modal.html",controller:"newHiveController",controllerAs:"vm",windowClass:"center-modal"});e.result.then(function(e){n.hives.push(e)})}}angular.module("apiaryApp").component("apiaryHives",{templateUrl:"components/hives/list/apiary-hives.component.html",controllerAs:"vm",controller:e,bindings:{$router:"<"}}),e.$inject=["authentication","$uibModal","hiveService"]}(),function(){"use strict";function e(e,t,o){var n=this;n.formData=t,n.modal={close:function(t){e.close(t)},cancel:function(){e.dismiss("cancel")}},n.onSubmit=function(){return n.formError="",n.formData.regNo&&n.formData.queenYear&&n.formData.location?void n.doUpdateHive(n.formData):(n.formError="Some required fields are empty",!1)},n.doUpdateHive=function(e){return o.update({id:t._id,regNo:e.regNo,queenYear:e.queenYear,location:e.location,note:e.note}).then(function(e){n.modal.close(e.data)},function(e){n.formError="Data has not been saved, please try again"}),!1}}angular.module("apiaryApp").controller("editHiveController",e),e.$inject=["$uibModalInstance","hiveData","hiveService"]}(),function(){"use strict";function e(e,t){var o=this;o.formData={},o.modal={close:function(t){e.close(t)},cancel:function(){e.dismiss("cancel")}},o.onSubmit=function(){return o.formError="",o.formData.regNo&&o.formData.queenYear&&o.formData.location?void o.doAddHive(o.formData):(o.formError="All fields except 'note' are required",!1)},o.doAddHive=function(e){return t.create({regNo:e.regNo,queenYear:e.queenYear,location:e.location,note:e.note}).then(function(e){o.modal.close(e.data)},function(e){o.formError="Hive has not been saved, please try again"}),!1}}angular.module("apiaryApp").controller("newHiveController",e),e.$inject=["$uibModalInstance","hiveService"]}(),function(){"use strict";function e(e){var t=this;t.inspection=[],t.$onInit=function(){t.hiveId=t.parent.hiveId,e.list(t.hiveId).then(function(e){t.inspections=e.data},function(e){console.log(e)})}}angular.module("apiaryApp").component("inspectionList",{templateUrl:"components/inspection/list/inspection-list.component.html",controller:e,controllerAs:"vm",require:{parent:"^hiveDetail"}}),e.$inject=["inspectionService"]}(),function(){"use strict";function e(e){var t=this;t.formError="",t.credentials={email:"",password:""},t.returnPage="",t.$routerOnActivate=function(e,o){o&&(t.returnPage=o.urlPath)},t.onSubmit=function(){e.login(t.credentials).then(function(e){t.returnPage&&"register"!==t.returnPage?t.$router.navigateByUrl(t.returnPage):t.$router.navigate(["Home"])})["catch"](function(e){t.formError=e.data.message})}}angular.module("apiaryApp").component("login",{templateUrl:"components/user/login/login.component.html",controllerAs:"vm",controller:e,bindings:{$router:"<"}}),e.$inject=["authentication"]}(),function(){"use strict";function e(e){var t=this;t.formError="",t.returnPage="",t.credentials={email:"",firstName:"",lastName:"",password:""},t.$onInit=function(){},t.$routerOnActivate=function(e,o){t.returnPage=o.urlPath},t.onSubmit=function(){e.register(t.credentials).then(function(e){t.returnPage&&"login"!==t.returnPage?t.$router.navigateByUrl(t.returnPage):t.$router.navigate(["Home"])})["catch"](function(e){t.formError=e.data.message})}}angular.module("apiaryApp").component("registration",{templateUrl:"components/user/registration/registration.component.html",controllerAs:"vm",controller:e,bindings:{$router:"<"}}),e.$inject=["authentication"]}(),function(){"use strict";angular.module("apiaryApp").service("greeter",function(){return function(e){return e+"bar"}})}(),function(){"use strict";angular.module("app.core",[])}(),angular.module("app.core").run(["$templateCache",function(e){e.put("components/home/apiary-home.component.html","<navigation></navigation><div class=container><div class=jumbotron><h1>Welcome to MyApiary</h1><p>An app to help beekeepers keep their bees in good shape!</p></div></div>"),e.put("components/navigation/navigation.component.html",'<nav class="navbar navbar-inverse"><div class=container><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#myNavbar><span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a ng-link="[\'Home\']" class=navbar-brand>My Apiary</a></div><div class="collapse navbar-collapse" id=myNavbar><ul class="nav navbar-nav"><li><a ng-link="[\'Home\']">Home</a></li><li><a ng-link="[\'Hives\']">Hives</a></li></ul><ul class="nav navbar-nav navbar-right"><li ng-hide=vm.isLoggedIn><a ng-link="[\'Register\']"><span class="glyphicon glyphicon-user"></span> Sign Up</a></li><li ng-hide=vm.isLoggedIn><a ng-link="[\'Login\']"><span class="glyphicon glyphicon-log-in"></span> Sign in</a></li><li ng-show=vm.isLoggedIn class=dropdown><a href class=dropdown-toggle data-toggle=dropdown>{{vm.currentUser.name }} <span class=caret></span></a><ul class=dropdown-menu role=menu><li><a href ng-click=vm.logout()>Logout</a></li></ul></li></ul></div></div></nav>'),e.put("components/root/apiary-root.component.html","<div><ng-outlet></ng-outlet></div>"),e.put("components/extraction/list/extraction-list.component.html","<h4>Extraction list goes here</h4>"),e.put("components/hives/detail/hive-detail.component.html",'<navigation></navigation><div class=container><div class=row><h4 class=col-md-12>{{ vm.hive.regNo }}</h4><div class=col-md-3><div>Queen year: {{ vm.hive.queenYear }}</div><div>Location: {{ vm.hive.location }}</div><div class=list-group><a class=list-group-item ng-link="[\'Inspections\']">Inspections</a> <a class=list-group-item ng-link="[\'Extractions\']">Extractions</a></div></div><div class=col-md-7>Note:<div class=apiary-text-mulitiline>{{ vm.hive.note }}</div></div><div class=col-md-2><button class="btn btn-success pull-right" ng-click=vm.popupEditHive()>Edit hive information</button></div><div class=col-md-12><ng-outlet></ng-outlet></div></div></div>'),e.put("components/hives/list/apiary-hives.component.html",'<navigation></navigation><div class=container><button class="btn btn-success" ng-click=vm.popupNewHive()>Add hive</button><table class=table><thead><tr><th>Reg no</th><th>Location</th><th>Queen year</th><th></th></tr></thead><tbody><tr ng-repeat="hive in vm.hives"><td>{{ hive.regNo }}</td><td>{{ hive.location }}</td><td>{{ hive.queenYear }}</td><td><button class="btn btn-default" ng-click=vm.showDetail(hive)><i class="fa fa-search-plus fa-lg"></i></button></td></tr></tbody></table></div>'),e.put("components/hives/modal/edit-hive.modal.html",'<div class=modal-content><form id=addHive name=addHive role=form class=form-horizontal ng-submit=vm.onSubmit()><div class=modal-header><button type=button ng-click=vm.modal.cancel() class=close><span aria-hidden=true>x</span> <span class=sr-only>Close</span></button><h4 id=modalLabel class=modal-title>Add new hive</h4></div><div class=modal-body><div role=alert ng-show=vm.formError class="alert alert-danger">{{ vm.formError }}</div><div class=form-group><label for=regNo class="col-xs-2 col-sm-2 control-label">Reg no</label><div class="col-xs-10 col-sm-10"><input type=text id=regNo name=regNo class=form-control ng-model=vm.formData.regNo></div></div><div class=form-group><label for=queenYear class="col-xs-2 col-sm-2 control-label">Queen year</label><div class="col-xs-10 col-sm-10"><input type=text id=queenYear name=queenYear class=form-control ng-model=vm.formData.queenYear></div></div><div class=form-group><label for=location class="col-xs-2 col-sm-2 control-label">Location</label><div class="col-xs-10 col-sm-10"><input type=text id=location name=location class=form-control ng-model=vm.formData.location></div></div><div class=form-group><label for=note class="col-xs-2 col-sm-2 control-label">Note</label><div class="col-xs-10 col-sm-10"><textarea type=text id=note name=note rows=5 class=form-control ng-model=vm.formData.note>\n                        </textarea></div></div></div><div class=modal-footer><button type=button class="btn btn-default" ng-click=vm.modal.cancel()>Cancel</button> <button type=submit class="btn btn-primary">Update hive</button></div></form></div>'),e.put("components/hives/modal/new-hive.modal.html",'<div class=modal-content><form id=addHive name=addHive role=form class=form-horizontal ng-submit=vm.onSubmit()><div class=modal-header><button type=button ng-click=vm.modal.cancel() class=close><span aria-hidden=true>x</span> <span class=sr-only>Close</span></button><h4 id=modalLabel class=modal-title>Add new hive</h4></div><div class=modal-body><div role=alert ng-show=vm.formError class="alert alert-danger">{{ vm.formError }}</div><div class=form-group><label for=regNo class="col-xs-2 col-sm-2 control-label">Reg no</label><div class="col-xs-10 col-sm-10"><input type=text id=regNo name=regNo class=form-control ng-model=vm.formData.regNo></div></div><div class=form-group><label for=queenYear class="col-xs-2 col-sm-2 control-label">Queen year</label><div class="col-xs-10 col-sm-10"><input type=text id=queenYear name=queenYear class=form-control ng-model=vm.formData.queenYear></div></div><div class=form-group><label for=location class="col-xs-2 col-sm-2 control-label">Location</label><div class="col-xs-10 col-sm-10"><input type=text id=location name=location class=form-control ng-model=vm.formData.location></div></div><div class=form-group><label for=note class="col-xs-2 col-sm-2 control-label">Note</label><div class="col-xs-10 col-sm-10"><textarea type=text id=note name=note rows=5 class=form-control ng-model=vm.formData.note>\n                        </textarea></div></div></div><div class=modal-footer><button type=button class="btn btn-default" ng-click=vm.modal.cancel()>Cancel</button> <button type=submit class="btn btn-primary">Create hive</button></div></form></div>'),e.put("components/inspection/list/inspection-list.component.html",'<h4>Inspections</h4><table class="table table-condensed" ng-show="vm.inspections.length > 0"><thead><tr><th>Date</th><th>Description</th><th class=text-center>Type</th><th class=text-center>Brood frames</th><th class=text-center>Food frames</th><th class=text-center>Pollen frames</th><th>Note</th></tr></thead><tbody><tr ng-repeat="inspection in vm.inspections"><td>{{ inspection.date | date: medium }}</td><td>{{ inspection.description }}</td><td class=text-center>{{ inspection.type }}</td><td class=text-center>{{ inspection.broodFrames }}</td><td class=text-center>{{ inspection.foodFrames }}</td><td class=text-center>{{ inspection.pollenFrames }}</td><td>{{ inspection.note }}</td></tr></tbody></table><h5 ng-show="vm.inspections.length < 1">No inspections to show</h5>'),e.put("components/user/login/login.component.html",'<navigation></navigation><div class=container><div class=row><div class="col-md-6 col-sm-12"><p class=lead>Not a member? Please <a ng-link="[\'Register\']">register</a> first</p><form ng-submit=vm.onSubmit()><div role=alert class="alert alert-danger" ng-show=vm.formError>{{ vm.formError }}</div><div class=form-group><label for=email>Email</label> <input type=email class=form-control id=email placeholder="Enter your email" ng-model=vm.credentials.email></div><div class=form-group><label for=password>Password</label> <input type=password class=form-control id=password placeholder="Enter your password" ng-model=vm.credentials.password></div><button class="btn btn-default" type=submit>Sign in!</button></form></div></div></div>'),e.put("components/user/registration/registration.component.html",'<navigation></navigation><div class=container><div class=row><div class="col-md-6 col-sm-12"><p class=lead>Already a member? Please <a ng-link="[\'Login\']">log in</a></p><form ng-submit=vm.onSubmit()><div role=alert class="alert alert-danger" ng-show=vm.formError>{{ vm.formError }}</div><div class=form-group><label for=firstName>First name</label> <input type=text class=form-control id=firstName placeholder="Enter your first name" ng-model=vm.credentials.firstName></div><div class=form-group><label for=lastName>Last name</label> <input type=text class=form-control id=lastName placeholder="Enter your last name" ng-model=vm.credentials.lastName></div><div class=form-group><label for=email>Email</label> <input type=email class=form-control id=email placeholder="Enter your email" ng-model=vm.credentials.email></div><div class=form-group><label for=password>Password</label> <input type=password class=form-control id=password placeholder="Enter your password" ng-model=vm.credentials.password></div><button class="btn btn-default" type=submit>Register!</button></form></div></div></div>')}]);